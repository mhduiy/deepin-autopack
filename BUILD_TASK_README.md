# æ‰“åŒ…ä»»åŠ¡ç³»ç»Ÿ - å‰ä¸‰æ­¥å®ç°å®Œæˆ

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. **æ£€æŸ¥ç¯å¢ƒ** (æ­¥éª¤0)
- âœ“ æ£€æŸ¥æœ¬åœ°ä»“åº“è·¯å¾„æ˜¯å¦å­˜åœ¨
- âœ“ æ£€æŸ¥ `dch` å·¥å…·ï¼ˆdebian changelogç”Ÿæˆï¼‰
- âœ“ æ£€æŸ¥ `gh` å·¥å…·ï¼ˆGitHubé¡¹ç›®ï¼‰
- âœ“ æ£€æŸ¥ `git-review` å·¥å…·ï¼ˆGerrité¡¹ç›®ï¼‰
- âœ“ æ£€æŸ¥ `debian/changelog` æ–‡ä»¶æ˜¯å¦å­˜åœ¨

### 2. **æ‹‰å–æœ€æ–°ä»£ç ** (æ­¥éª¤1)
- âœ“ Fetch è¿œç¨‹ä»“åº“æœ€æ–°ä»£ç 
- âœ“ Checkout åˆ°æ­£ç¡®çš„åˆ†æ”¯ï¼ˆGitHubåˆ†æ”¯æˆ–Gerritåˆ†æ”¯ï¼‰
- âœ“ Pull æœ€æ–°å˜æ›´
- âœ“ è®°å½•æœ€æ–° commit hash å’Œä¿¡æ¯
- âœ“ ä¿å­˜ commit hash åˆ°ä»»åŠ¡è®°å½•

### 3. **ç”ŸæˆChangelog** (æ­¥éª¤2)
- âœ“ å¯¹äºGitHubé¡¹ç›®ï¼Œåˆ›å»ºæ‰“åŒ…åˆ†æ”¯ `dev-changelog-{version}`
- âœ“ è®¾ç½® DEBEMAIL ç¯å¢ƒå˜é‡ï¼ˆä»å…¨å±€é…ç½®è¯»å–ï¼‰
- âœ“ è·å–ä¸Šä¸€ä¸ª git tag ä½œä¸ºåŸºå‡†ç‰ˆæœ¬
- âœ“ è·å–ä»ä¸Šä¸€ä¸ªtagåˆ°HEADçš„æ‰€æœ‰commitè®°å½•
- âœ“ ä½¿ç”¨ `dch -v {version}` é€è¡Œæ·»åŠ changelogæ¡ç›®
- âœ“ ä½¿ç”¨ `dch -r ''` é‡Šæ”¾changelog
- âœ“ è®°å½•è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼ˆç‰ˆæœ¬ã€åŸºå‡†ç‰ˆæœ¬ã€å˜æ›´è®°å½•æ•°ï¼‰

## ğŸ“‹ APIæ¥å£

### åˆ›å»ºä»»åŠ¡
```bash
POST /api/tasks/create
{
  "project_id": 1,
  "mode": "normal",  # normal/changelog_only/crp_only
  "version": "1.0.1",
  "architectures": ["amd64", "arm64"],
  "start_commit_hash": ""
}
```

### å¯åŠ¨ä»»åŠ¡
```bash
POST /api/tasks/{task_id}/start
```

### è·å–ä»»åŠ¡è¯¦æƒ…
```bash
GET /api/tasks/{task_id}
```

### è·å–ä»»åŠ¡åˆ—è¡¨
```bash
GET /api/tasks
```

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹å¼1: ä½¿ç”¨æµ‹è¯•è„šæœ¬
```bash
cd /home/uos/Dev/deepin-autopack-1
/home/uos/.local/venv/bin/python3 test_build_task.py
```

### æ–¹å¼2: ä½¿ç”¨curlå‘½ä»¤
```bash
# 1. åˆ›å»ºä»»åŠ¡
curl -X POST http://localhost:5000/api/tasks/create \
  -H "Content-Type: application/json" \
  -d '{
    "project_id": 1,
    "mode": "normal",
    "version": "1.0.test",
    "architectures": ["amd64"]
  }'

# 2. å¯åŠ¨ä»»åŠ¡ï¼ˆæ›¿æ¢{task_id}ä¸ºå®é™…IDï¼‰
curl -X POST http://localhost:5000/api/tasks/{task_id}/start

# 3. æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
curl http://localhost:5000/api/tasks/{task_id}
```

### æ–¹å¼3: é€šè¿‡Webç•Œé¢
1. è®¿é—® http://localhost:5000/tasks
2. ç‚¹å‡»ç›‘æ§é¡µé¢çš„"æ‰“åŒ…"æŒ‰é’®
3. å¡«å†™ç‰ˆæœ¬å·å’Œé€‰é¡¹
4. æäº¤åæŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨

## ğŸ“ æ—¥å¿—ç¤ºä¾‹

### æ­¥éª¤0: æ£€æŸ¥ç¯å¢ƒ
```
ç¯å¢ƒæ£€æŸ¥é€šè¿‡:
âœ“ ä»“åº“è·¯å¾„æ­£å¸¸
âœ“ dchå·¥å…·å·²å®‰è£…
âœ“ ghå·¥å…·å·²å®‰è£…
âœ“ debian/changelogæ–‡ä»¶å­˜åœ¨
```

### æ­¥éª¤1: æ‹‰å–æœ€æ–°ä»£ç 
```
ä»£ç æ‹‰å–æˆåŠŸ
åˆ†æ”¯: master
æœ€æ–°æäº¤: abc12345
æäº¤ä¿¡æ¯: feat: add new feature
```

### æ­¥éª¤2: ç”ŸæˆChangelog
```
Changelogå·²ç”Ÿæˆ
ç‰ˆæœ¬: 1.0.1
åŸºäºç‰ˆæœ¬: 1.0.0
åŒ…å« 15 æ¡å˜æ›´è®°å½•
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒè¦æ±‚**:
   - å¿…é¡»å®‰è£… `devscripts` åŒ…ï¼ˆåŒ…å«dchå‘½ä»¤ï¼‰
   - GitHubé¡¹ç›®éœ€è¦å®‰è£… `gh` å‘½ä»¤
   - Gerrité¡¹ç›®éœ€è¦å®‰è£… `git-review` å‘½ä»¤

2. **é…ç½®è¦æ±‚**:
   - å…¨å±€é…ç½®ä¸­å¿…é¡»è®¾ç½® `maintainer_email`
   - é¡¹ç›®é…ç½®ä¸­å¿…é¡»è®¾ç½®æ­£ç¡®çš„åˆ†æ”¯å
   - æœ¬åœ°ä»“åº“å¿…é¡»å·²å…‹éš†å¹¶å­˜åœ¨

3. **æƒé™è¦æ±‚**:
   - å¯¹æœ¬åœ°ä»“åº“ç›®å½•æœ‰è¯»å†™æƒé™
   - å¯ä»¥åˆ›å»ºGitåˆ†æ”¯

## ğŸ”œ å¾…å®ç°æ­¥éª¤

- [ ] æ­¥éª¤3: æäº¤Commit
- [ ] æ­¥éª¤4: æ¨é€åˆ°è¿œç¨‹
- [ ] æ­¥éª¤5: åˆ›å»ºPR
- [ ] æ­¥éª¤6: ç›‘æ§PRçŠ¶æ€
- [ ] æ­¥éª¤7: ç­‰å¾…åŒæ­¥
- [ ] æ­¥éª¤8: CRPæ‰“åŒ…
- [ ] æ­¥éª¤9: ç›‘æ§æ‰“åŒ…

## ğŸ› é—®é¢˜æ’æŸ¥

### å¦‚æœä»»åŠ¡å¤±è´¥ï¼Œæ£€æŸ¥ï¼š
1. æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…ä¸­çš„ `error_message` å­—æ®µ
2. æŸ¥çœ‹æ¯ä¸ªæ­¥éª¤çš„ `error_message`
3. æ£€æŸ¥Flaskåº”ç”¨æ—¥å¿—è¾“å‡º
4. ç¡®è®¤ç¯å¢ƒå·¥å…·éƒ½å·²å®‰è£…
5. ç¡®è®¤é¡¹ç›®é…ç½®æ­£ç¡®

### å¸¸è§é”™è¯¯ï¼š
- "æœ¬åœ°ä»“åº“ä¸å­˜åœ¨": éœ€è¦å…ˆåœ¨é¡¹ç›®é…ç½®ä¸­å…‹éš†ä»“åº“
- "æœªå®‰è£…dchå·¥å…·": `sudo apt install devscripts`
- "debian/changelogæ–‡ä»¶ä¸å­˜åœ¨": é¡¹ç›®ä¸æ˜¯debianåŒ…é¡¹ç›®
- "è·å–ä¸Šä¸€ä¸ªtagå¤±è´¥": ä»“åº“å¯èƒ½æ²¡æœ‰tagï¼Œä¼šä½¿ç”¨é»˜è®¤æ¶ˆæ¯
